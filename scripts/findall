#!/bin/bash

HERE="$(cd $(dirname "${BASH_SOURCE[0]}") && pwd)"
PROJ="$HERE/.."

USAGE='Usage: findall [ TARGET... ] PATTERN'

PATTERN=
TARGETS=()

# No arguments given
if (( $# == 0 )); then
    echo "$USAGE" >&2
    exit 1
fi

while (( $# > 0 )); do
    case "$1" in
        -h|--help)
            echo "$USAGE"; exit ;;
        *)
            (( $# == 1 )) && PATTERN="$1" || TARGETS+=( "$1" ) ;;
    esac
    shift
done

# No targets given
# Default to C++ source and test directories
(( ${#TARGETS[@]} == 0 )) &&
    TARGETS=( src test libmucs/{include/mucs,src} )

pushd "$PROJ" >/dev/null

    /bin/grep -EnRI --color=auto "$PATTERN" "${TARGETS[@]}"

popd >/dev/null
